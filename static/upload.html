<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="../static/uploads/css/main.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>
<body>
<!-- introduction page -->
<div class="bg">
	<div class = "text-container1"> 
		<h1 class = bgh1>Art Classifier</h1>
		<p class = bgp> Upload an art image to determine the style, time period, <br>or author using this simple classifier! (accepts .png, .jpg, .jpeg)</p> 
		<button class=button type = "button" onclick = "bottum()"> Begin </button> <!-- autoscrolls down to second page-->
		<!-- TODO: add an about us button that either redirects to a new page or has a hover feature -->
	</div>
</div>

<div class ="bg2">
    <div class = "text-container">

        <form id="image-upload-form" name="myForm" onsubmit="return uploadImage()" method="POST" onchange="display()">
            <div class = "left" > 
                <h3 class = "lineheight"> 1. Upload your image </h3>
                <p class = "lineheight"> accepts .png, .jpg, .jpeg  <br> </p>
                <label for="img" class="button">Upload</label>
                <div class="drag-box" id = "drag-box">
                    <input type="file" class="hide-file-button" id = "img" name="image" accept="image/*">
                </div>
                <div class = "display-box">
                    <img class = "image-format" id="image"> </img>
                </div>
            </div>
            <div class = "middle">
                <h3 class = "lineheight"> 2. Choose your classifier </h3>
                <p class = "lineheight"> Hover over for more info</p>
                <div class="button-container">
                    <p> Work in progress </p> 
                </div>
            </div>
            <div class = "right"> 
                <h3 class = "lineheight"> 3. Classify </h3>	
                <p class = "lineheight"> Press GO to classify!</p>
                <button type="submit" class = "button">Go!</button>
                <div class = "display-box"> 
                    <div id = "code"></div>
                    <div id="error"></div>
                </div>
            </div>
        </form>
    </div>
</div>


<script>
const form = document.getElementById("image-upload-form");
const url = "/";
function bottum() {
	document.getElementById('begin').scrollIntoView({behavior: "smooth"});
};

function display() {
    document.getElementById('drag-box').style.display = "none"
    const files = document.querySelector('[type=file]').files;
    const formData = new FormData();
    if (files.length == 0) {
        document.getElementById('code').innerHTML = 'No Image Uploaded, please try again!';
        return false;
    }

    var image = document.getElementById('image');
    image.src = URL.createObjectURL(files[0]);
}

function uploadImage() {
    document.getElementById('code').innerHTML = 'Loading...';
    // Add the file to the image
    const files = document.querySelector('[type=file]').files;
    const formData = new FormData();
    if (files.length == 0) {
        document.getElementById('code').innerHTML = 'No Image Uploaded, please try again!';
        return false;
    }

    for (let i = 0; i < files.length; i++) {
        let file = files[i];
        formData.append('image', file);
    }
    fetch(
        url,
        {
            method: 'POST',
            body: formData,
        }
    ).then((response) => {
        if (response.status == 200) {
            document.getElementById('error').innerHTML = "";
            return response.text().then((response_text) => {
                document.getElementById('code').innerHTML = response_text;
            });
        } else {
            document.getElementById('code').innerHTML = "";
            return response.text().then((response_text) => {
                console.log(response_text);
                document.getElementById('error').innerHTML = "Error: " + response_text;
            });
        }
    })
    ;        
    return false;
}
</script>
